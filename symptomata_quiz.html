<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Symptomata Quiz</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        fetch('navbar.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('navbar-placeholder').innerHTML = data;
        })
        .catch(error => console.error('Error loading navbar:', error));
        
        let terms = [];
        let selectedTerms = []; // Move to global scope

        // Fetch terms and meanings from the file
        async function loadTerms() {
            console.log('Loading terms...'); // Checkpoint
            try {
                const response = await fetch('symptomata_quiz.txt');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.text();
                console.log('File fetched successfully:', data.slice(0, 100)); // Log first 100 characters
                terms = data.trim().split('\n').map(line => {
                    const [term, meaning] = line.split(' â€“ ').map(item => item.trim());
                    return { term, meaning };
                });
                console.log('Parsed terms:', terms.slice(0, 5)); // Log first 5 parsed terms
            } catch (error) {
                console.error('Error loading quiz file:', error);
                alert('Failed to load quiz data. Please try again later.');
            }
        }

        async function startQuiz() {
            console.log('Starting quiz...'); // Checkpoint
            await loadTerms(); // Ensure terms are loaded before starting the quiz

            if (terms.length === 0) {
                alert('No quiz data available. Please check the file and try again.');
                console.log('No terms loaded.'); // Checkpoint
                return;
            }

            const quizContainer = document.getElementById('quizContainer');
            quizContainer.innerHTML = ''; // Clear previous content

            // Shuffle terms and select 10 random unique ones
            console.log('Shuffling terms...'); // Checkpoint
            const shuffledTerms = [...terms].sort(() => 0.5 - Math.random());
            selectedTerms = shuffledTerms.slice(0, 10);
            console.log('Selected terms:', selectedTerms); // Log selected terms

            selectedTerms.forEach((questionTerm, index) => {
                const questionContainer = document.createElement('div');
                questionContainer.className = 'question';

                // Add question text
                const questionText = document.createElement('p');
                questionText.textContent = `Q${index + 1}: What is the meaning of "${questionTerm.term}"?`;
                questionContainer.appendChild(questionText);

                // Prepare options (1 correct + 3 random incorrect)
                const correctAnswer = questionTerm.meaning;
                const incorrectOptions = terms
                    .filter(item => item.meaning !== correctAnswer)
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 3)
                    .map(item => item.meaning);

                const allOptions = [...incorrectOptions, correctAnswer].sort(() => 0.5 - Math.random());
                console.log(`Q${index + 1} options:`, allOptions); // Log options for each question

                // Add options to the question
                allOptions.forEach(option => {
                    const label = document.createElement('label');
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `question${index}`;
                    input.value = option;

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(option));

                    const optionContainer = document.createElement('div');
                    optionContainer.className = 'option';
                    optionContainer.appendChild(label);

                    questionContainer.appendChild(optionContainer);
                });

                quizContainer.appendChild(questionContainer);
            });

            // Add submit button
            const submitButton = document.createElement('button');
            submitButton.textContent = 'Submit Quiz';
            submitButton.onclick = submitQuiz;
            quizContainer.appendChild(submitButton);
            console.log('Quiz generated successfully.'); // Checkpoint
        }

        function submitQuiz() {
            console.log('Submitting quiz...'); // Checkpoint
            let score = 0;

            const quizContainer = document.getElementById('quizContainer');
            const questions = quizContainer.getElementsByClassName('question');

            Array.from(questions).forEach((question, index) => {
                const selectedOption = question.querySelector('input[type="radio"]:checked');
                if (selectedOption && selectedOption.value === selectedTerms[index].meaning) {
                    score++;
                }
            });

            console.log(`Final score: ${score}`); // Log score
            alert(`You scored ${score} out of 10!`);
        }
    </script>
</head>
<body>
    <!-- Navigation Menu -->
    <div id="navbar-placeholder"></div> <!-- Placeholder for the navbar -->
    <header>
        <h1>Symptomata Quiz</h1>
    </header>

    <main>
        <p>Test your knowledge of medical symptoms by starting the quiz below!</p>
        <button onclick="startQuiz()">Start Quiz</button>
        <div id="quizContainer"></div>
    </main>

    <footer>
        <p>&copy; 2024 MediLingua. All rights reserved.</p>
    </footer>
</body>
</html>
